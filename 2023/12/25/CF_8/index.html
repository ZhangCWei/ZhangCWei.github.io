<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","Sidebar Display (only for Muse | Mist), available values":["hide    expand only when click on the sidebar toggle icon."],"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="机器无关代码优化 编译器是将高级语言翻译成机器语言(汇编语言)的工具,它的一个重要任务是将代码转化为更加高效的目标代码,以达到更好的性能和...">
<meta property="og:type" content="article">
<meta property="og:title" content="编译原理8：机器无关的优化">
<meta property="og:url" content="http://example.com/2023/12/25/CF_8/index.html">
<meta property="og:site_name" content="Methods for DIP">
<meta property="og:description" content="机器无关代码优化 编译器是将高级语言翻译成机器语言(汇编语言)的工具,它的一个重要任务是将代码转化为更加高效的目标代码,以达到更好的性能和...">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/image-20231214113949719.png">
<meta property="og:image" content="http://example.com/images/image-20231214114001547.png">
<meta property="og:image" content="http://example.com/images/image-20231214114349059.png">
<meta property="og:image" content="http://example.com/images/image-20231229152757580.png">
<meta property="og:image" content="http://example.com/images/image-20231214145055251.png">
<meta property="og:image" content="http://example.com/images/image-20231219100926974.png">
<meta property="og:image" content="http://example.com/images/image-20231219101230860.png">
<meta property="og:image" content="http://example.com/images/image-20231219102339094.png">
<meta property="og:image" content="http://example.com/images/image-20231219102854625.png">
<meta property="og:image" content="http://example.com/images/image-20231219104643641.png">
<meta property="og:image" content="http://example.com/images/image-20231219110943736.png">
<meta property="og:image" content="http://example.com/images/image-20231219111359729.png">
<meta property="og:image" content="http://example.com/images/image-20231219112250942.png">
<meta property="og:image" content="http://example.com/images/image-20231221100410824.png">
<meta property="og:image" content="http://example.com/images/image-20231221102227180.png">
<meta property="og:image" content="http://example.com/images/image-20231221103124105.png">
<meta property="og:image" content="http://example.com/images/image-20231221103748486.png">
<meta property="og:image" content="http://example.com/images/image-20231221104445588.png">
<meta property="og:image" content="http://example.com/images/image-20231229155017437.png">
<meta property="og:image" content="http://example.com/images/image-20231229155625149.png">
<meta property="og:image" content="http://example.com/images/image-20231229155706196.png">
<meta property="og:image" content="http://example.com/images/image-20231221105205931.png">
<meta property="og:image" content="http://example.com/images/image-20231221110643148.png">
<meta property="og:image" content="http://example.com/images/image-20231221111134927.png">
<meta property="article:published_time" content="2023-12-25T09:03:07.000Z">
<meta property="article:modified_time" content="2024-02-12T14:31:23.930Z">
<meta property="article:author" content="ZhangChengWei">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/image-20231214113949719.png">


<link rel="canonical" href="http://example.com/2023/12/25/CF_8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/12/25/CF_8/","path":"2023/12/25/CF_8/","title":"编译原理8：机器无关的优化"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>编译原理8：机器无关的优化 | Methods for DIP</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Methods for DIP</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">By ZhangCW & WeiGP & JiangT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">机器无关的优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%9A%84%E6%9D%A5%E6%BA%90"><span class="nav-text">优化的来源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90"><span class="nav-text">数据流分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E5%88%86%E5%86%97%E4%BD%99%E6%B6%88%E9%99%A4"><span class="nav-text">部分冗余消除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A2%AB%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88%E8%B7%B3%E8%BF%87%EF%BC%89"><span class="nav-text">被使用的表达式（跳过）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E7%9A%84%E8%AF%86%E5%88%AB%E3%80%81%E5%88%86%E6%9E%90%E5%92%8C%E4%BC%98%E5%8C%96"><span class="nav-text">循环的识别、分析和优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZhangChengWei</p>
  <div class="site-description" itemprop="description">paper analysis</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/25/CF_8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZhangChengWei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Methods for DIP">
      <meta itemprop="description" content="paper analysis">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="编译原理8：机器无关的优化 | Methods for DIP">
      <meta itemprop="description" content="机器无关代码优化 编译器是将高级语言翻译成机器语言(汇编语言)的工具,它的一个重要任务是将代码转化为更加高效的目标代码,以达到更好的性能和...">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          编译原理8：机器无关的优化
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-25 17:03:07" itemprop="dateCreated datePublished" datetime="2023-12-25T17:03:07+08:00">2023-12-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-12 22:31:23" itemprop="dateModified" datetime="2024-02-12T22:31:23+08:00">2024-02-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CF/" itemprop="url" rel="index"><span itemprop="name">CF</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">机器无关代码优化 编译器是将高级语言翻译成机器语言(汇编语言)的工具,它的一个重要任务是将代码转化为更加高效的目标代码,以达到更好的性能和...</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1>机器无关的优化</h1>
<p><strong>引言</strong></p>
<ul>
<li>代码优化或者代码改进
<ul>
<li>在目标代码中消除<strong>不必要</strong>的指令</li>
<li>把一个指令序列替换为一个完成相同功能的<strong>更快</strong>的指令序列</li>
</ul>
</li>
<li><strong>全局</strong>优化
<ul>
<li>具体的优化实现基于<strong>数据流分析技术</strong></li>
<li>用以收集程序相关信息的算法</li>
</ul>
</li>
</ul>
<h2 id="优化的来源">优化的来源</h2>
<ul>
<li>优化的主要来源
<ul>
<li>编译器只能通过一些相对低层的语义等价转换来优化代码</li>
<li>冗余运算的原因
<ul>
<li>源程序中的冗余</li>
<li>高级程序设计语言编程的副产品，如A[i][j].f = 0; A[i][j].k = 1;</li>
</ul>
</li>
<li>语义不变的优化
<ul>
<li>公共子表达式消除</li>
<li>复制传播</li>
<li>死代码消除</li>
<li>常量折叠</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231214113949719.png" alt="image-20231214113949719" style="zoom:50%;" />
<img src="/images/image-20231214114001547.png" alt="image-20231214114001547" style="zoom:50%;" />
<ul>
<li>控制流图
<ul>
<li>表示程序控制流的有向图 (简称流图)</li>
<li>流图的结点是基本块</li>
<li>流图的边指明了哪些基本块可以跟在一个基本块之后运行
<ul>
<li>若<strong>基本块B~i~最后一条指令</strong>执行后紧跟着执行的指令可能为<strong>基本块B~j~</strong>，则图上有一条边<strong>B~i~→B~j~</strong></li>
</ul>
</li>
<li>图上的路径表示程序执行的路径，可作为优化与分析的基础
<ul>
<li>它给出了程序的<strong>控制流</strong></li>
<li>可以根据流图了解到一个值是否会被使用等信息</li>
</ul>
</li>
</ul>
</li>
<li>流图的构造
<ul>
<li>流图的结点是基本块</li>
<li>存在边 B → C 的情况
<ul>
<li>B的结尾指令是一条跳转到C的开头的条件/无条件语句</li>
<li>C紧跟在B之后，且B的结尾不是无条件跳转语句</li>
<li>我们称B是C的前驱，C是B的后继</li>
</ul>
</li>
<li>入口/出口结点
<ul>
<li>不和任何中间指令对应；<strong>入口</strong>到<strong>第一条指令</strong>有一条边；任何<strong>可能最后执行</strong>的基本块到<strong>出口</strong>有一条边</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231214114349059.png" alt="image-20231214114349059" style="zoom:50%;" />
<ul>
<li>
<p><strong>循环</strong></p>
<ul>
<li>程序的大部分运行时间花费在循环上，因此<strong>循环是识别的重点</strong> (优化的目标)</li>
<li>循环的定义
<ul>
<li>循环L是一个<strong>结点集合</strong></li>
<li>存在一个<strong>循环入口</strong> (Loop entry) 结点，是<strong>唯一</strong>的、前驱可以在循环L之外的结点，<strong>到达循环内其余结点的路径必然先经过这个入口结点</strong></li>
<li>循环内其余结点都存在到达<strong>入口结点</strong>的<strong>非空路径</strong>，且路径都在L中</li>
</ul>
</li>
<li>上图中的循环有：
<ul>
<li>{ B~3~ }</li>
<li>{ B~6~ }</li>
<li>{ B~2~, B~3~, B~4~ }</li>
</ul>
</li>
<li>对于{ B~2~, B~3~, B~4~ }  ：
<ul>
<li>B~2~为入口结点</li>
<li>B~1~, B~5~, B~6~不在循环内
<ul>
<li>到达B~1~可不经过B~2~</li>
<li>B~5~, B~6~没有到达B~2~的结点</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>全局公共子表达式</strong></p>
<ul>
<li>若 E 在某次出现之前<strong>必然</strong>已被计算过，且 E 的运算<strong>分量</strong>在该次计算之后<strong>没有被改变</strong></li>
<li>那么，E 的本次出现就是一个<strong>公共子表达式</strong></li>
<li>如果上次E值赋给了 x，且 x 值没有被修改过，那么我们<strong>可使用 x</strong>，而无需计算 E</li>
</ul>
</li>
<li>
<p>示例</p>
</li>
</ul>
<img src="/images/image-20231229152757580.png" alt="image-20231229152757580" style="zoom:50%;" />
<img src="/images/image-20231214145055251.png" alt="image-20231214145055251" style="zoom:67%;" />
<ul>
<li><strong>复制传播</strong>
<ul>
<li>形如 u = v 的复制语句使得语句后面的程序点上，u 的值等于 v 的值
<ul>
<li>如果在某个位置上u一定等于v，那么可以把u替换为v</li>
<li>有时可以彻底消除对u的使用，从而消除对u的赋值语句</li>
</ul>
</li>
<li>右图所示，消除公共子表达式时引入了复制语句
<ul>
<li>d + e 冗余计算，且计算后没有修改过</li>
<li>如果后面尽可能用 t 来替换 c，可能就不需要 c = t 这个语句</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219100926974.png" alt="image-20231219100926974" style="zoom:50%;" />
<ul>
<li>复制传播的示例
<ul>
<li>右图显示了对 B~5~ 进行复制传播处理的情况
<ul>
<li>可能消除所有对 x 的使用</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219101230860.png" alt="image-20231219101230860" style="zoom:50%;" />
<ul>
<li><strong>死代码消除</strong>
<ul>
<li>如果一个变量在某个程序点上的值可能会在之后被使用，那么这个变量在这个点上活跃的；否则这个变量就是死的，此时对该变量的赋值就是没有用的死代码</li>
<li>死代码多半是因为前面的<strong>优化</strong>而形成的</li>
<li>比如，B5中的 x = t~3~ 就是死代码</li>
<li>消除后得到</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219102339094.png" alt="image-20231219102339094" style="zoom:50%;" />
<ul>
<li><strong>代码移动</strong>
<ul>
<li>循环中的代码会被执行很多次
<ul>
<li>循环不变表达式：循环的同一次运行的不同迭代中， 表达式的值不变</li>
</ul>
</li>
<li>把循环不变表达式移动到循环入口之前计算可以提高效率
<ul>
<li>循环入口：进入循环的跳转都以这个入口为目标</li>
</ul>
</li>
<li>while (i &lt;= limit – 2) …
<ul>
<li>如果循环体不改变 limit 的值，可在循环外计算 limit – 2</li>
<li>t = limit – 2<br>
while (i &lt;= t) …</li>
</ul>
</li>
</ul>
</li>
<li><strong>归纳变量和强度消减</strong>
<ul>
<li>每次对x赋值都使x增加c</li>
<li>把赋值改为增量操作，可消减计算强度</li>
<li>两个归纳变量步调一致，可删除一个</li>
<li>例子
<ul>
<li>循环开始保持 t~4~ = 4 * j</li>
<li>j = j – 1 后面的 t~4~ = 4 * j 每次赋值使 t~4~ 减 4</li>
<li>可替换为 t~4~ = t~4~ – 4</li>
<li>t~2~ 也可同样处理为 t~2~ = t~2~ + 4</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219102854625.png" alt="image-20231219102854625" style="zoom:50%;" />
<h2 id="数据流分析">数据流分析</h2>
<ul>
<li>
<p>数据流分析</p>
<ul>
<li>用于获取<strong>数据沿着程序执行路径流动</strong>信息的相关技术，是优化的基础</li>
<li>例如
<ul>
<li>两个表达式是否一定计算得到相同的值？(<strong>可用表达式</strong>→公共子表达式)</li>
<li>一个语句的计算结果是否可能被后续语句使用？(<strong>活跃变量分析</strong>→死代码消除)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>数据流抽象</p>
<ul>
<li>
<p>程序点</p>
<ul>
<li>三地址语句<strong>之前</strong>或<strong>之后</strong>的位置</li>
<li>基本块内部：一个语句之后的程序点等于下一个语句之前的程序点</li>
<li>如果流图中有B1到B2的边，那么B2的第一个语句之前的<strong>点</strong>可能紧跟在B1的最后语句之后的<strong>点</strong>后面执行</li>
</ul>
</li>
<li>
<p>从p~1~到p~n~的<strong>执行路径</strong>：p~1~, p~2~, …, p~n~</p>
<ul>
<li>要么p~i~是一个<strong>语句之前</strong>的点，且p~i+1~是该<strong>语句之后</strong>的点</li>
<li>要么p~i~是某个<strong>基本块的结尾</strong>，且p~i+1~是该<strong>基本块的某个后继的开头</strong></li>
</ul>
</li>
<li>
<p>出现在某个程序点的<strong>程序状态</strong></p>
<ul>
<li>在某运行时刻，当指令指针指向这个程序点时，各个变量和动态内存中存放的<strong>值</strong></li>
<li>指令指针<strong>可能</strong>多次指向同一个程序点，因此一个程序点可能对应<strong>多个</strong>程序状态</li>
</ul>
</li>
<li>
<p>数据流分析把可能出现在<strong>某个程序点上的程序状态集合</strong>总结为一些特性</p>
<ul>
<li>不管程序怎么运行，当它到达某个程序点时，程序状态<strong>总是满足</strong>分析得到的特性</li>
<li>不同的分析技术关心不同的信息</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219104643641.png" alt="image-20231219104643641" style="zoom:50%;" />
<ul>
<li><strong>性质和算法</strong>
<ul>
<li>根据不同的需要来设置不同的性质集合，然后设计分析算法
<ul>
<li>程序点上的性质被表示成为<strong>数据流值</strong>，求解这些数据流值实际上就是推导这些性质的过程</li>
</ul>
</li>
<li>例子
<ul>
<li>如果要求出变量在某个点上的值可能在哪里定值，可以使用到达定值 (Reaching Definition)
<ul>
<li>性质形式：x 由 d1 定值</li>
</ul>
</li>
<li>如果希望实现常量折叠优化，我们关心的是某个点上变量x的值是否总是由某个常量赋值语句赋予
<ul>
<li>性质形式：x = c，以及x = NAC（Not A Constant）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>数据流分析
<ul>
<li>对一组约束求解，得到各个点上的数据流值
<ul>
<li>两类约束：基于<strong>语句语义</strong>和基于<strong>控制流</strong></li>
</ul>
</li>
<li>基于<strong>语句语义</strong>的约束
<ul>
<li>一个语句之前和之后的数据流值受到其语义的约束
<ul>
<li>语句语义通常用转换函数表示，它把一个数据流值<strong>映射</strong>为另一个数据流值
<ul>
<li>OUT[s] = 𝑓~s~(IN[s]) // 正向</li>
<li>IN[s] =𝑓~s~(OUT[s]) // 逆向</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>基于<strong>控制流</strong>的约束
<ul>
<li>在基本块内部，<strong>一个语句的输出 = 下一语句的输入</strong></li>
<li>流图的控制流边也对应新的约束</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219110943736.png" alt="image-20231219110943736" style="zoom:50%;" />
<ul>
<li>基本块内的数据流模式
<ul>
<li>基本块内的控制流非常简单
<ul>
<li>从头到尾不会中断</li>
<li>没有分支</li>
</ul>
</li>
<li>基本块的效果就是各个语句的效果的<strong>复合</strong></li>
<li>可以预先处理基本块内部的数据流关系，给出基本块对应的<strong>转换函数</strong>
<ul>
<li>OUT[B] = 𝑓~B~(IN[B]) 或 IN[B] = 𝑓~B~(OUT[B])</li>
</ul>
</li>
<li>设基本块包含语句𝑠~1~, 𝑠~2~, … , 𝑠~n~
<ul>
<li>𝑓~B~ = 𝑓~sn~ ∘ ⋯ ∘ 𝑓~s2~ ∘ 𝑓~s1~</li>
</ul>
</li>
</ul>
</li>
<li>基本块之间的控制流约束
<ul>
<li><strong>前向数据流问题</strong>
<ul>
<li>B的传递函数根据IN[B]计算得到OUT[B]</li>
<li>IN[B]和B的<strong>各前驱基本块</strong>的OUT值之间具有约束关系</li>
</ul>
</li>
<li>逆向数据流问题
<ul>
<li>B的传递函数根据OUT[B]计算得到IN[B]</li>
<li>OUT[B]和B的<strong>各后继基本块</strong>的IN值之间具有约束关系</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219111359729.png" alt="image-20231219111359729" style="zoom: 50%;" />
<ul>
<li>
<p>数据流方程解的<strong>精确性</strong>和<strong>安全性</strong></p>
<ul>
<li>数据流方程通常没有唯一解</li>
<li>目标是寻找一个最“精确”且满足约束的解
<ul>
<li>精确：能够进行更多的改进</li>
<li>满足约束：根据分析结果来改进代码是<strong>安全</strong>的</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>到达定值</strong></p>
<ul>
<li>假定 x 有定值 d，如果存在一个路径，从<strong>紧随 d 的点到达某点 p</strong>，并且此路径上面<strong>没有 x 的其他定值点</strong>，则称 x 的定值 d 到达 p</li>
<li>如果在这条路径上有对 x 的其它定值，我们说变量 x 的这个定值 d 被<strong>杀死</strong>了</li>
<li>如果某个变量 x 的一个定值 d 到达了点 p，在 p 点使用变量x的时候，x 的值是由 d最后定值的</li>
<li>到达定值的解<strong>允许不精确</strong>，但<strong>必须是安全的</strong>
<ul>
<li>分析得到的到达定值可能实际上不会到达</li>
<li>但是实际到达的一定要被分析出来，否则不安全</li>
</ul>
</li>
<li>比如确定x在p点是否为<strong>常量</strong>
<ul>
<li>忽略实际的到达定值使得变化的值被误认为常量，将这些值替换为常量会引起错误，<strong>不安全</strong></li>
<li><strong>过多</strong>估计则相反</li>
</ul>
</li>
</ul>
</li>
<li>
<p>示例</p>
<ul>
<li>B~1~全部定值到达B~2~的开头</li>
<li>d~5~到达B~2~的开头 (循环)</li>
<li>d~2~被d~5~杀死，不能到达B~3~、B~4~的开头</li>
<li>d~4~不能到达B~2~的开头，因为被d~7~杀死</li>
<li>d~6~到达B~2~的开头</li>
</ul>
</li>
</ul>
<img src="/images/image-20231219112250942.png" alt="image-20231219112250942" style="zoom:50%;" />
<ul>
<li><strong>语句/基本块的转换方程</strong>
<ul>
<li>定值 𝑑: 𝑢 = 𝑣 + 𝑤
<ul>
<li>生成了对变量 𝑢 的定值 𝑑，杀死其它对 𝑢 的定值</li>
<li>生成-杀死（gen-kill）形式：𝑓~𝑑~(𝑥) = 𝑔𝑒𝑛~𝑑~ ∪ (𝑥 – 𝑘𝑖𝑙𝑙~𝑑~)</li>
<li>𝑔𝑒𝑛~𝑑~ = 𝑑 , 𝑘𝑖𝑙𝑙~𝑑~ = { 程序中其它对 𝑢 的定值 }</li>
</ul>
</li>
<li>生成-杀死形式的函数复合仍具有该形式
<ul>
<li><strong>生成的定值</strong>：由第二部分生成、以及由第一部分生成且没有被第二部分杀死</li>
<li><strong>杀死的定值</strong>：被第一部分杀死、以及被第二部分杀死的定值</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>𝑓</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msub><mi>f</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>𝑥</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mn>2</mn></msub><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mn>1</mn></msub><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑥</mi><mo>−</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mn>2</mn></msub><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mn>1</mn></msub><mo>−</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑥</mi><mo>−</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>1</mn></msub><mo>∪</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
𝑓_2(f_1(𝑥)) &amp;= 𝑔𝑒𝑛_2 ∪ (𝑔𝑒𝑛_1 ∪ (𝑥 - 𝑘𝑖𝑙𝑙_1) - 𝑘𝑖𝑙𝑙_2) \\&amp;= (𝑔𝑒𝑛_2 ∪ (𝑔𝑒𝑛_1 - 𝑘𝑖𝑙𝑙_2)) ∪ (𝑥 - 𝑘𝑖𝑙𝑙_1 ∪ 𝑘𝑖𝑙𝑙_2)
\end{align}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.75em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></p>
<ul>
<li>
<ul>
<li>设 B 有n个语句，第 i 个语句的转换函数为𝑓~i~</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝑓</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>𝑥</mi><mo stretchy="false">)</mo><mo>=</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mi>n</mi></msub><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑥</mi><mtext>–</mtext><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>B</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">𝑓_B(𝑥)=𝑔𝑒𝑛_n∪(𝑥–𝑘𝑖𝑙𝑙_B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">–</span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mi>B</mi></msub><mo>=</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mi>n</mi></msub><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mtext>–</mtext><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>∪</mo><mo>⋯</mo><mo>∪</mo><mo stretchy="false">(</mo><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mn>1</mn></msub><mtext>–</mtext><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>2</mn></msub><mtext>–</mtext><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>3</mn></msub><mtext>–</mtext><mo>…</mo><mo>−</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">𝑔𝑒𝑛_B=𝑔𝑒𝑛_n∪(𝑔𝑒𝑛_{n-1}–𝑘𝑖𝑙𝑙_n)∪⋯∪(𝑔𝑒𝑛_1–𝑘𝑖𝑙𝑙_2–𝑘𝑖𝑙𝑙_3–…-𝑘𝑖𝑙𝑙_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mord">–</span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">–</span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">–</span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">–</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>B</mi></msub><mo>=</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>1</mn></msub><mo>∪</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mn>1</mn></msub><mo>∪</mo><mo>⋯</mo><mo>∪</mo><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">𝑘𝑖𝑙𝑙_B=𝑘𝑖𝑙𝑙_1∪𝑘𝑖𝑙𝑙_1∪⋯∪𝑘𝑖𝑙𝑙_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑔</mi><mi>𝑒</mi><msub><mi>𝑛</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">𝑔𝑒𝑛_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是被第 i 个语句生成，且没有被其后的句子杀死的定值的集合</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑘</mi><mi>𝑖</mi><mi>𝑙</mi><msub><mi>𝑙</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">𝑘𝑖𝑙𝑙_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">ki</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为被 B 各个语句杀死的定值的并集</li>
</ul>
</li>
</ul>
</li>
<li>
<p>活跃变量分析</p>
<ul>
<li>定义
<ul>
<li>x 在 p 上的值是否会在<strong>某条从 p 出发的路径中使用</strong></li>
<li>变量 x 在 p 上<strong>活跃</strong>，<strong>当且仅当</strong>存在<strong>一条</strong>从 p 开始的路径，该路径的<strong>末端</strong>使用了 x，且路径上<strong>没有对 x 进行定值</strong></li>
</ul>
</li>
<li>用途
<ul>
<li>寄存器分配/死代码删除/…</li>
</ul>
</li>
<li>数据流值
<ul>
<li>(活跃) 变量的集合</li>
</ul>
</li>
</ul>
</li>
<li>
<p>可用表达式分析</p>
<ul>
<li>x + y在p点可用的条件
<ul>
<li>从流图入口结点到达p的<strong>每条路径</strong>都对x + y求值，且在最后一次求值之后再没有对x或y赋值</li>
</ul>
</li>
<li>主要用途
<ul>
<li>寻找<strong>全局公共子表达式</strong></li>
</ul>
</li>
<li>生成-杀死
<ul>
<li><strong>生成</strong>：基本块求值x + y，且之后没有对x或y赋值，那么它生成了x + y</li>
<li><strong>杀死</strong>：基本块对x或y赋值，且没有重新计算x + y，那么它杀死了x + y</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="部分冗余消除">部分冗余消除</h2>
<ul>
<li>消除冗余计算
<ul>
<li>目标：尽量减少<strong>表达式求值</strong>的次数</li>
<li>对于表达式x + y
<ul>
<li><strong>全局公共子表达式</strong>：如果对x + y求值前的程序点上x + y可用，那么不需要再对x + y求值</li>
<li><strong>循环不变表达式</strong>：循环中的表达式x + y的值不变，可以只计算一次</li>
<li><strong>部分冗余</strong>：在程序按照某些路径到达这个点的时候x + y已经被计算过，但沿着另外一些路径到达时，x + y尚未计算过</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231221100410824.png" alt="image-20231221100410824" style="zoom:50%;" />
<ul>
<li>需要添加基本块来消除的冗余
<ul>
<li>进行两种操作
<ul>
<li>在<strong>关键边</strong>上增加基本块</li>
<li>进行<strong>代码复制</strong></li>
</ul>
</li>
<li>关键边
<ul>
<li>从<strong>具有多个后继的结点</strong>到达<strong>具有多个前驱的结点</strong></li>
<li>如下图1中的 B~3~→B~4~</li>
</ul>
</li>
<li>示例
<ul>
<li>为了优化某条路径，而使另外一条路径计算量增加，这是不允许的</li>
<li>下图2中的情况更为复杂，需要进行对 B~6~ 和与其关联的 B~4~ 进行代码复制</li>
<li>下图2中的优化是没必要的，因为复制了控制流，会大大增加优化后代码的大小</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231221102227180.png" alt="image-20231221102227180" style="zoom:50%;" />
<ul>
<li>懒惰代码移动
<ul>
<li>目标
<ul>
<li>所有不复制代码就可消除的冗余计算都被消除</li>
<li>优化后的代码不会执行原程序中不执行的任何计算</li>
<li>表达式的计算应该<strong>尽量靠后</strong>，以利于寄存器的分配</li>
</ul>
</li>
<li>冗余消除
<ul>
<li>完全冗余</li>
<li>部分冗余：在流图中<strong>放置</strong>表达式x + y的<strong>拷贝</strong>，使得某处的x + y成为完全冗余，从而删除</li>
</ul>
</li>
<li>基本步骤
<ol>
<li>找出各程序点上<strong>预期执行</strong>的所有表达式</li>
<li>在表达式被预期执行但是不可用的程序点上，放置表达式的计算</li>
<li>把表达式尽量<strong>后延</strong>到某个程序点（考虑到寄存器分配），在到达这个点的所有路径上，这个表达式在这个程序点之前被预期执行，但是还没有使用这个值</li>
<li>消除只使用一次的临时变量</li>
</ol>
</li>
<li>被预期执行
<ul>
<li>如果从程序点p出发的<strong>所有路径都会计算</strong>表达式b + c的值，并且b和c在那时的值<strong>就是它们在点p的值</strong>，那么表达式b + c在点p上被预期执行</li>
<li>示例1
<ul>
<li>表达式b + c在B~3~、B~4~、B~5~、 B~6~、B~7~和B~9~的入口处被预期执行</li>
<li>B~2~ 没有预期执行，因为其改变了 c 的值</li>
<li>B~8~ 没有预期执行，因为它不一定会执行 b+c</li>
</ul>
</li>
</ul>
</li>
<li>可用表达式
<ul>
<li>和前面的可用表达式类似，但假设代码已经被<strong>复制到了预期执行点</strong>上</li>
<li>表达式在基本块的<strong>出口处可用</strong>的条件
<ul>
<li>在基本块的入口处可用，或在基本块的入口处的预期执行表达式中</li>
<li>且没有被这个基本块杀死</li>
</ul>
</li>
</ul>
</li>
<li>可后延表达式
<ul>
<li>在保持程序语义的情况下，尽可能延后计算表达式</li>
<li>示例2
<ul>
<li>b + c在B~1~被预期执行</li>
<li>b + c可后延到B~4~→B~7~的边上</li>
</ul>
</li>
</ul>
</li>
<li>
<h2 id="被使用的表达式（跳过）">被使用的表达式（跳过）</h2>
</li>
</ul>
</li>
</ul>
<p><img src="/images/image-20231221103124105.png" alt="image-20231221103124105" style="zoom:60%;" /><img src="/images/image-20231221103748486.png" alt="image-20231221103748486" style="zoom:80%;float:right" /></p>
<h2 id="循环的识别、分析和优化">循环的识别、分析和优化</h2>
<ul>
<li><strong>支配结点</strong>
<ul>
<li>如果每条<strong>从入口结点到达n的路径都经过d</strong>，那么 d 支配 n，记为𝑑 dom 𝑛</li>
</ul>
</li>
<li>示例：
<ul>
<li>1支配所有结点；</li>
<li>2只支配自己；</li>
<li>3支配除了1、2外的其它结点；</li>
<li>4支配1、2、3外的其它结点；</li>
<li>5、6只支配自身；</li>
<li>7支配7、8、9、10；</li>
<li>8支配8、9、10；</li>
<li>9、10只支配自身</li>
</ul>
</li>
</ul>
<p><img src="/images/image-20231221104445588.png" alt="image-20231221104445588" style="zoom: 75%;" /><img src="/images/image-20231229155017437.png" alt="image-20231229155017437" style="zoom: 75%;" /></p>
<ul>
<li>支配结点树
<ul>
<li><strong>支配结点树</strong>可以表示支配关系
<ul>
<li><strong>根结点</strong>：入口结点</li>
<li>每个结点d支配且只支配树中的<strong>后代结点</strong></li>
</ul>
</li>
<li><strong>直接支配节点</strong>
<ul>
<li>从入口结点到达n的任何路径 (不含n) 中，它是路径中<strong>最后</strong>一个支配n的结点</li>
<li>前面的例子：1直接支配3，3直接支配4</li>
<li><strong>n的直接支配结点m</strong>具有如下性质：如果𝑑 ≠ 𝑛且𝑑 dom 𝑛，那么𝑑 dom 𝑚</li>
</ul>
</li>
</ul>
</li>
<li>寻找支配节点算法
<ul>
<li>计算流图中各个结点n的所有支配结点
<ul>
<li>𝑝~1~, 𝑝~2~, … , 𝑝~𝑘~是𝑛的所有前驱且𝑑 ≠ 𝑛，那么𝑑 dom 𝑛当且仅当𝑑 dom 𝑝~𝑖~ (1 ≤ 𝑖 ≤ 𝑘)</li>
</ul>
</li>
<li>一个结点的<strong>支配结点集合</strong>是它的<strong>所有前驱的支配结点集合的交集</strong> (加上它<strong>自己</strong>)</li>
<li><strong>前向</strong>数据流分析问题</li>
<li>求解如图所示的数据流方程组，可以得到各结点对应的支配结点集合。其中，IN[B]是在<strong>基本块B入口处</strong>的支配结点集合，OUT[B]是在<strong>基本块B出口处</strong>的支配结点集合。
<ul>
<li>OUT[ENTRY] = {ENTRY}</li>
<li>OUT[B] = IN[B] ∪ {B}                    (B ≠ ENTRY)</li>
<li>IN[B] = ∩ ~P是B的一个前驱~OUT[P]       (B ≠ ENTRY)</li>
</ul>
</li>
<li>D(n) = OUT[n]</li>
<li>示例：
<ul>
<li>注意：
<ul>
<li>N是全节点集合</li>
<li>3的前驱是1、2、4、8</li>
<li>4、7的前驱同理</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231229155625149.png" alt="image-20231229155625149" style="zoom:50%;" />
<img src="/images/image-20231229155706196.png" alt="image-20231229155706196" style="zoom:50%;" />
<ul>
<li>深度优先生成树
<ul>
<li><strong>深度优先搜索</strong> (Depth-First Search / DFS)
<ul>
<li>搜索过程从入口结点开始，并首先访问已知离入口结点<strong>最远</strong>的结点</li>
</ul>
</li>
<li><strong>深度优先生成树</strong>
<ul>
<li>一个深度优先过程中的搜索<strong>路线</strong>形成了一个深度优先生成树 (Depth-First Spanning Tree / DFST)</li>
</ul>
</li>
</ul>
</li>
<li>示例：
<ul>
<li><strong>实线边</strong>形成了这棵树，<strong>虚线边</strong>是流图中其它的边</li>
<li>左边：流图，右边：深度优先生成树</li>
</ul>
</li>
</ul>
<img src="/images/image-20231221105205931.png" alt="image-20231221105205931" style="zoom: 67%;" />
<ul>
<li>流图中边的分类
<ul>
<li>为一个流图构造出<strong>DFST</strong>之后，流图中的边可以分为三类
<ul>
<li>前进边：从结点m到达m在DFST树中的一个真后代结点的边 (DFST中的所有边都是前进边)</li>
<li>后退边：从m到达m在DFST树中的某个祖先 (包括m) 的边</li>
<li>交叉边：边的src和dest都不是对方的祖先</li>
</ul>
</li>
<li>示例，上图2中，10→7是后退边，5→7是交叉边</li>
</ul>
</li>
<li>==<strong>回边与可归约性</strong>==
<ul>
<li>回边的定义
<ul>
<li>边a→b，头b<strong>支配</strong>了尾a（注意不是直接支配）</li>
<li>每条回边都是后退边，但不是所有后退边都是回边</li>
</ul>
</li>
<li>若一个流图的任何深度优先生成树的<strong>所有后退边都是回边</strong>，则该流图就是<strong>可归约</strong>的</li>
</ul>
</li>
<li><strong>自然循环</strong>
<ul>
<li>自然循环的性质
<ul>
<li>有一个<strong>唯一</strong>的入口结点 (循环头Header)，这个结点<strong>支配</strong>循环中的所有结点</li>
<li>必然存在<strong>进入循环头的回边</strong></li>
</ul>
</li>
<li>自然循环的定义
<ul>
<li>给定回边n→<strong>d</strong>的自然循环是d，加上<strong>不经过d就能够到达n的结点的集合</strong></li>
<li>d是这个循环的头</li>
</ul>
</li>
<li>示例
<ul>
<li>回边：10 → 7
<ul>
<li>{ 7, 8, 10 }</li>
</ul>
</li>
<li>回边：7 → 4
<ul>
<li>{ 4, 5, 6, 7, 8, 10 }</li>
<li>结点 8 可以不经过 4 就到达 7</li>
<li>包含了前面的循环</li>
</ul>
</li>
<li>回边4 → 3 (8 → 3)
<ul>
<li>同样的头</li>
<li>同样的结点集合{ 3, 4, 5, 6, 7, 8, 10 }</li>
</ul>
</li>
<li>回边9→1
<ul>
<li>整个流图</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="/images/image-20231221110643148.png" alt="image-20231221110643148" style="zoom:50%;" />
<ul>
<li><strong>循环头上头</strong>
<ul>
<li>每个自然循环都有一个循环头header</li>
<li>一些循环相关的优化 (如循环不变量移动) 需要<strong>在循环头之前插入代码</strong></li>
<li>常见做法是在循环头之前插入一个<strong>基本块</strong> (称为 preheader)，用于存放相关的代码</li>
</ul>
</li>
</ul>
<img src="/images/image-20231221111134927.png" alt="image-20231221111134927" style="zoom: 67%;" />
<h2 id="总结">总结</h2>
<ul>
<li>优化的来源
<ul>
<li>冗余计算</li>
</ul>
</li>
<li>基本优化技术
<ul>
<li>公共子表达式消除、复制传播、死代码消除、常量折叠</li>
</ul>
</li>
<li>数据流分析
<ul>
<li>控制流图</li>
<li>到达定值分析、活跃变量分析、可用表达式分析</li>
</ul>
</li>
<li>部分冗余消除
<ul>
<li>预期执行表达式、懒惰代码移动</li>
</ul>
</li>
<li>循环的识别
<ul>
<li>支配节点、自然循环</li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/08/CF_7/" rel="prev" title="编译原理7：目标代码生成">
                  <i class="fa fa-angle-left"></i> 编译原理7：目标代码生成
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZhangChengWei</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">



</body>
</html>
